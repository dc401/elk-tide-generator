title: GCP Compute Engine Snapshot Deleted
id: e3f4a5b6-c7d8-4b9c-8d1e-2f3a4b5c6d7e
status: experimental
description: Detects the deletion of a Compute Engine disk snapshot. Attackers may
  delete snapshots to inhibit system recovery (T1490) as part of a ransomware or destructive
  attack. This activity is often noisy; it is best to correlate with other suspicious
  events or tune for high-volume deletions from a single principal.
references:
- https://attack.mitre.org/techniques/T1490/
- https://cloud.google.com/compute/docs/disks/create-snapshots
author: Automated Detection Agent
date: '2024-07-31'
modified: '2024-07-31'
tags:
- attack.impact
- attack.t1490
logsource:
  product: gcp
  service: gcp.audit
detection:
  selection:
    protoPayload.serviceName: compute.googleapis.com
    protoPayload.methodName: v1.compute.snapshots.delete
    protoPayload.status.code: 0
  filter_legitimate:
    protoPayload.authenticationInfo.principalEmail|endswith:
    - '@gcp-sa-cloud-storage-transfer.iam.gserviceaccount.com'
    - -compute@developer.gserviceaccount.com
  condition: selection and not filter_legitimate
falsepositives:
- Automated backup lifecycle management scripts or tools deleting old or expired snapshots.
- Manual cleanup of test or development snapshots by engineers.
level: high
fields:
- protoPayload.authenticationInfo.principalEmail
- resource.labels.project_id
- protoPayload.resourceName
- timestamp
test_scenarios:
  true_positive: A compromised account executes a script to loop through and delete
    all available disk snapshots in a project.
  false_negative: An attacker removes the IAM policy that grants access to the snapshots,
    effectively making them inaccessible without deleting them.
  false_positive: A daily scheduled job running as a service account deletes snapshots
    older than 30 days as per the defined retention policy.
  true_negative: A new snapshot is created as part of a daily backup process.
  log_source_schema: https://cloud.google.com/logging/docs/audit#audit_log_entry_structure
  example_log_fields:
    protoPayload.methodName: v1.compute.snapshots.delete
    protoPayload.serviceName: compute.googleapis.com
    protoPayload.authenticationInfo.principalEmail: attacker@evil.com

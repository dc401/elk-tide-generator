title: GCP Project-Level IAM Policy Discovery
id: a9b0c1d2-e3f4-4d5e-8f6a-7b8c9d0e1f2a
status: experimental
description: Detects the use of 'GetIamPolicy' at a project level. This is a foundational
  discovery technique (T1087.004) used by attackers to map the permission landscape,
  identify principals and roles, and find potential privilege escalation paths.
references:
- https://attack.mitre.org/techniques/T1087/004/
- https://cloud.google.com/iam/docs/reference/rest/v1/projects/getIamPolicy
author: Automated Detection Agent
date: '2024-07-31'
modified: '2024-07-31'
tags:
- attack.discovery
- attack.t1087.004
logsource:
  product: gcp
  service: gcp.audit
detection:
  selection:
    protoPayload.serviceName: cloudresourcemanager.googleapis.com
    protoPayload.methodName: GetIamPolicy
  filter_legitimate:
    protoPayload.authenticationInfo.principalEmail|endswith:
    - '@cloudservices.gserviceaccount.com'
    - -compute@developer.gserviceaccount.com
    - '@gcp-sa-config-connector.iam.gserviceaccount.com'
  condition: selection and not filter_legitimate
falsepositives:
- Security scanners, compliance tools, or audit scripts enumerating permissions across
  projects.
- Administrators or developers checking permissions while troubleshooting.
- GCP-internal services performing checks.
level: informational
fields:
- protoPayload.authenticationInfo.principalEmail
- resource.labels.project_id
- timestamp
test_scenarios:
  true_positive: An attacker runs `gcloud projects get-iam-policy <project-id>` after
    gaining initial access to understand who has what permissions.
  false_negative: An attacker uses the `gcloud asset search-all-iam-policies` command,
    which uses a different API and might not be caught by this rule.
  false_positive: A security engineer runs a script that iterates through all projects
    and calls `get-iam-policy` on each one to generate a permissions report.
  true_negative: A user gets the IAM policy for a single Cloud Storage bucket, which
    uses a different serviceName.
  log_source_schema: https://cloud.google.com/logging/docs/audit#audit_log_entry_structure
  example_log_fields:
    protoPayload.methodName: GetIamPolicy
    protoPayload.serviceName: cloudresourcemanager.googleapis.com
    protoPayload.authenticationInfo.principalEmail: attacker@evil.com

title: GCP Service Account Discovery
id: b1c2d3e4-f5a6-4e7f-8b9c-0d1e2f3a4b5c
status: experimental
description: Detects the listing of service accounts in a project. This is a common
  discovery technique (T1087.004) used by attackers after initial access to identify
  high-privilege service accounts for impersonation or targeting.
references:
- https://attack.mitre.org/techniques/T1087/004/
- https://cloud.google.com/iam/docs/reference/rest/v1/projects.serviceAccounts/list
author: Automated Detection Agent
date: '2024-07-31'
modified: '2024-07-31'
tags:
- attack.discovery
- attack.t1087.004
logsource:
  product: gcp
  service: gcp.audit
detection:
  selection:
    protoPayload.serviceName: iam.googleapis.com
    protoPayload.methodName: google.iam.admin.v1.ListServiceAccounts
  filter_legitimate:
    protoPayload.authenticationInfo.principalEmail|endswith:
    - '@cloudservices.gserviceaccount.com'
    - -compute@developer.gserviceaccount.com
  condition: selection and not filter_legitimate
falsepositives:
- Security scanners or compliance scripts enumerating service accounts.
- Administrators using the GCP console or gcloud CLI to view service accounts.
level: informational
fields:
- protoPayload.authenticationInfo.principalEmail
- resource.labels.project_id
- timestamp
test_scenarios:
  true_positive: An attacker runs `gcloud iam service-accounts list` to find potential
    target accounts for impersonation.
  false_negative: An attacker obtains a list of service accounts through an out-of-band
    method, such as from public code repositories.
  false_positive: A developer lists the service accounts in their project to find
    the correct one for an application.
  true_negative: An administrator creates a new service account.
  log_source_schema: https://cloud.google.com/logging/docs/audit#audit_log_entry_structure
  example_log_fields:
    protoPayload.methodName: google.iam.admin.v1.ListServiceAccounts
    protoPayload.serviceName: iam.googleapis.com
    protoPayload.authenticationInfo.principalEmail: attacker@evil.com

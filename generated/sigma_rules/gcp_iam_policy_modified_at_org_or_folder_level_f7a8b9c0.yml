title: GCP IAM Policy Modified at Org or Folder Level
id: f7a8b9c0-d1e2-4c3d-8e4f-5a6b7c8d9e0f
status: experimental
description: Detects modifications to IAM policies at the Organization or Folder level.
  Changes at this level are high-impact and can be used for widespread lateral movement
  (T1078.004) by granting an attacker's account permissions across multiple projects.
references:
- https://attack.mitre.org/techniques/T1078/004/
- https://cloud.google.com/resource-manager/docs/access-control-org
author: Automated Detection Agent
date: '2024-07-31'
modified: '2024-07-31'
tags:
- attack.lateral_movement
- attack.privilege_escalation
- attack.t1078.004
logsource:
  product: gcp
  service: gcp.audit
detection:
  selection:
    protoPayload.serviceName: cloudresourcemanager.googleapis.com
    protoPayload.methodName: SetIamPolicy
    resource.type:
    - organization
    - folder
    protoPayload.status.code: 0
  filter_legitimate:
    protoPayload.authenticationInfo.principalEmail:
    - org-admin-group@example.com
    - central-iac@my-org.iam.gserviceaccount.com
  condition: selection and not filter_legitimate
falsepositives:
- Authorized Organization Administrators or central IaC service accounts deploying
  new organization-wide security policies or role bindings.
level: critical
fields:
- protoPayload.authenticationInfo.principalEmail
- protoPayload.request.policy.bindings.role
- protoPayload.request.policy.bindings.members
- resource.type
- resource.labels.folder_id
- resource.labels.organization_id
test_scenarios:
  true_positive: An attacker who compromised a Folder Admin account adds their external
    account as 'Folder Owner', gaining control over all projects within that folder.
  false_negative: An attacker moves laterally between two projects without modifying
    Folder or Organization level policies.
  false_positive: A central security team, using an approved service account, applies
    a new custom role binding to all projects by setting the IAM policy at the organization
    level.
  true_negative: A project administrator grants a developer 'roles/viewer' on a single
    project.
  log_source_schema: https://cloud.google.com/logging/docs/audit#audit_log_entry_structure
  example_log_fields:
    protoPayload.methodName: SetIamPolicy
    resource.type: folder
    protoPayload.authenticationInfo.principalEmail: compromised-folder-admin@example.com

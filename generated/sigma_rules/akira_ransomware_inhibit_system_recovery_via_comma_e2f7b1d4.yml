title: Akira Ransomware Inhibit System Recovery via Command
id: e2f7b1d4-8c8a-4d7a-8f6a-0d9c44b1b3e1
status: stable
description: Detects specific commands used by Akira ransomware to inhibit system
  recovery by deleting Volume Shadow Copies (VSS) and disabling the Windows Recovery
  Environment. This is a common precursor to data encryption.
references:
- https://attack.mitre.org/techniques/T1490/
- https://www.cisa.gov/news-events/cybersecurity-advisories/aa23-353a
author: Automated Detection Agent
date: '2024-07-29'
modified: '2024-07-30'
tags:
- attack.impact
- attack.t1490
logsource:
  product: windows
  service: process_creation
  category: process_creation
detection:
  selection:
    process.name:
    - vssadmin.exe
    - wmic.exe
    - bcdedit.exe
    process.command_line|contains|any:
    - delete shadows
    - shadowcopy delete
    - recoveryenabled no
    - bootstatuspolicy ignoreallfailures
  filter_legitimate:
    process.parent.executable|contains:
    - C:\Program Files\Veeam\
    - C:\Program Files (x86)\Acronis\
    - C:\Program Files\Veritas\
    - C:\Windows\System32\svchost.exe
  condition: selection and not filter_legitimate
falsepositives:
- Legitimate system administration or backup software maintenance scripts that perform
  similar actions. Tuning may be required to whitelist specific admin tools or parent
  processes.
level: high
fields:
- user.name
- process.executable
- process.command_line
- process.parent.executable
- host.name
test_scenarios:
  true_positive: A process `vssadmin.exe delete shadows /all /quiet` is executed by
    a suspicious parent process.
  false_negative: An attacker uses a custom tool to interact with the VSS API directly
    without calling vssadmin.exe.
  false_positive: A legitimate backup job initiated by Veeam software runs 'vssadmin.exe
    delete shadows' to clean up old snapshots.
  true_negative: A user runs 'vssadmin.exe list shadows' to view existing shadow copies.
  log_source_schema: https://www.elastic.co/guide/en/ecs/current/ecs-process.html
  example_log_fields:
    process.name: vssadmin.exe
    process.command_line: vssadmin.exe delete shadows /all /quiet
    process.parent.executable: C:\Users\victim\AppData\Local\Temp\malware.exe
    event.category: process_creation

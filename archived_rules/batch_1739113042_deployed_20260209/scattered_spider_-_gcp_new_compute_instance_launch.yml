name: Scattered Spider - GCP New Compute Instance Launch
description: Detects attempts by Scattered Spider to launch new Google Cloud Platform
  (GCP) compute instances. Adversaries may provision new resources to expand their
  attack infrastructure, host malicious services, or facilitate data exfiltration.
type: query
query: event.category:api AND cloud.provider:gcp AND event.outcome:success AND event.action:compute.instances.insert
language: lucene
index:
- logs-*
- gcp.auditlog-*
filters: []
risk_score: 70
severity: high
threat:
- framework: MITRE ATT&CK
  tactic:
    id: TA0003
    name: Persistence
    reference: https://attack.mitre.org/tactics/TA0003/
  technique:
  - id: T1098.005
    name: Cloud Account
    reference: https://attack.mitre.org/techniques/T1098/005/
- framework: MITRE ATT&CK
  tactic:
    id: TA0008
    name: Impact
    reference: https://attack.mitre.org/tactics/TA0008/
  technique:
  - id: T1578
    name: Supply Chain Compromise
    reference: https://attack.mitre.org/techniques/T1578/
references:
- https://attack.mitre.org/techniques/T1098/005/
- https://attack.mitre.org/techniques/T1578/
- https://www.elastic.co/guide/en/ecs/current/ecs-cloud.html
- https://cloud.google.com/compute/docs/reference/rest/v1/instances/insert
author:
- Detection Agent
false_positives:
- Legitimate users or automated systems launching new instances for scaling, development,
  testing, or approved infrastructure changes. Requires context and correlation with
  change management.
note: '## Triage

  Investigate: the user account launching the instance, the instance configuration
  (machine type, image, network settings), and the purpose. Verify if the action was
  authorized and expected.'
test_cases:
- type: TP
  description: Successful launch of a new GCP compute instance
  log_entry:
    event:
      category: api
      action: compute.instances.insert
      outcome: success
    cloud:
      provider: gcp
    user:
      name: malicious-user@example.com
    gcp:
      audit:
        resource:
          type: compute.googleapis.com/Instance
          name: attacker-c2-vm
    '@timestamp': '2024-03-12T23:30:00Z'
  expected_match: true
  evasion_technique: null
- type: TP
  description: Another successful launch of a new GCP compute instance
  log_entry:
    event:
      category: api
      action: compute.instances.insert
      outcome: success
    cloud:
      provider: gcp
    user:
      name: compromised-service-account@gcp-project.iam.gserviceaccount.com
    gcp:
      audit:
        resource:
          type: compute.googleapis.com/Instance
          name: exfil-server
    '@timestamp': '2024-03-12T23:30:15Z'
  expected_match: true
  evasion_technique: null
- type: FN
  description: Launch of a different cloud resource type (e.g., Cloud SQL instance)
  log_entry:
    event:
      category: api
      action: sqladmin.instances.create
      outcome: success
    cloud:
      provider: gcp
    user:
      name: malicious-user@example.com
    gcp:
      audit:
        resource:
          type: sqladmin.googleapis.com/Instance
          name: malicious-db
    '@timestamp': '2024-03-12T23:31:00Z'
  expected_match: false
  evasion_technique: Launches a different type of cloud resource (Cloud SQL) not covered
    by 'compute.instances.insert'.
- type: FP
  description: Legitimate auto-scaling group launching a new instance
  log_entry:
    event:
      category: api
      action: compute.instances.insert
      outcome: success
    cloud:
      provider: gcp
    user:
      name: system-managed-service-account@gcp-project.iam.gserviceaccount.com
    gcp:
      audit:
        resource:
          type: compute.googleapis.com/Instance
          name: web-app-scale-up-03
    '@timestamp': '2024-03-14T11:20:00Z'
  expected_match: false
  evasion_technique: null
- type: TN
  description: Normal GCP API call (network creation)
  log_entry:
    event:
      category: api
      action: compute.networks.insert
      outcome: success
    cloud:
      provider: gcp
    user:
      name: network-admin@example.com
    gcp:
      audit:
        resource:
          type: compute.googleapis.com/Network
          name: new-vpc-network
    '@timestamp': '2024-03-14T11:25:00Z'
  expected_match: false
  evasion_technique: null
